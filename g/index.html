<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Guest</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<style>
 body { font-family: Arial; padding:20px; }
 textarea { width:100%; height:100px; margin-top:10px; }
 pre { background:#eee; padding:10px; margin-top:20px; }
</style>
</head>
<body>

<h2>GUEST</h2>
코드: <input id="codeIn" maxlength="8" style="width:120px;">
<button onclick="connect()">Connect</button>

<h3>생성된 ANSWER (Host에게 전달)</h3>
<textarea id="ansOut"></textarea>

<pre id="log"></pre>

<script>
const SERVER = "https://chat.keddie213.workers.dev/";

function log(t){ document.getElementById("log").textContent += t + "\n"; }

function decompress(s){ return LZString.decompressFromEncodedURIComponent(s); }
function compress(s){ return LZString.compressToEncodedURIComponent(s); }

let pc;

async function connect(){
  const code = document.getElementById("codeIn").value.trim();
  if(code.length !== 8){ alert("8자리 코드 입력"); return; }

  const offer = await (await fetch(SERVER + code)).text();
  const offerSDP = decompress(offer);

  pc = new RTCPeerConnection();

  pc.ondatachannel = e => {
    const ch = e.channel;
    ch.onmessage = msg => log("Host: " + msg.data);
  };

  await pc.setRemoteDescription({ type:"offer", sdp:offerSDP });

  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);

  const answerCmp = compress(answer.sdp);
  document.getElementById("ansOut").value = answerCmp;

  log("ANSWER 생성됨 → Host에게 전달해야 함.");
}
</script>

</body>
</html>
