<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Guest</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<style>
body { font-family: monospace; margin: 20px; }
</style>
</head>
<body>

<h2>GUEST</h2>

<input id="code" placeholder="ë°© ì½”ë“œ 8ìžë¦¬ ìž…ë ¥">
<button onclick="join()">Join</button>

<pre id="log"></pre>

<script>
const WORKER = "https://chat.keddie213.workers.dev/";
function log(t){ document.getElementById("log").textContent += t + "\n"; }

let pc, channel;

async function join(){
  const code = document.getElementById("code").value.trim();
  if(code.length != 8) return alert("ì½”ë“œ 8ìžë¦¬ ìž…ë ¥í•´ë¼");

  log("ðŸ“¡ Fetching offer...");

  let res = await fetch(WORKER + code);
  if(!res.ok) return log("âŒ Offer not found.");

  let compressed = await res.text();
  let sdp = LZString.decompressFromEncodedURIComponent(compressed);

  pc = new RTCPeerConnection();
  pc.ondatachannel = (ev)=>{
    channel = ev.channel;
    channel.onmessage = e => log("ðŸ‘¤ Host: " + e.data);
    channel.onopen = ()=> log("ðŸ”µ Connected!");
  };

  await pc.setRemoteDescription({ type: "offer", sdp });

  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);

  const ansComp = LZString.compressToEncodedURIComponent(answer.sdp);

  await fetch(WORKER + code + "_ans", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ data: ansComp })
  });

  log("ðŸ“¨ Answer sent!");
}
</script>

</body>
</html>
