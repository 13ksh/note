<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>fullAutoPPT</title>

  <!-- pptxgenjs -->
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin-top: 6px;
    }
  </style>
</head>
<body>

<h1>fullAutoPPT</h1>

<input id="apikey" placeholder="Gemini API Key" style="width:800px"><br>
<a href="https://aistudio.google.com/api-keys" target="_blank">여기를 눌러 API 키를 발급받으세요</a><br><br>
<input id="topic" placeholder="주제 (예: 유튜브)" style="width:800px"><br><br>
<input id="count" type="number" min="4" max="48" value="8"><a>개의 슬라이드</a><br><br>

<button onclick="run()">PPT 만들기(약 10초 소요)</button>

<script>
//https://aistudio.google.com/api-keys
const MODEL = "gemini-2.5-flash";

async function run() {
  const apiKey = document.getElementById("apikey").value.trim();
  const topic = document.getElementById("topic").value.trim();
  const count = document.getElementById("count").value;

  if (!apiKey || !topic) {
    alert("API 키와 주제를 입력하세요");
    return;
  }

  const prompt =  `
주제가 주어지면 학교 발표용 PPT 내용을 작성하세요.

[중요 규칙]
- 총 ${count}개의 항목만 작성하세요.
- 각 항목은 반드시 아래 형식을 정확히 따르세요.
- 형식 이외의 설명, 번호, 기호, 머리말은 절대 쓰지 마세요.
- "텍스트"라는 단어를 절대 사용하지 마세요.
- 교과서 말투로 작성하세요.

[출력 형식]
제목
설명 (2~4줄 문장, 줄바꿈 허용)

(항목과 항목 사이는 반드시 빈 줄 1줄)

[출력 예시]
1.라면에 대하여
라면은 국수를 뜨거운 증기로 쪄낸 후 기름에 튀겨 건조시킨 면에
분말 스프를 별도로 첨부한 즉석 식품을 의미합니다.
간편한 조리 방식과 중독성 있는 맛으로 전 세계에서 사랑받고 있습니다.

2.라면이 왜 주목 받는가?
조리 시간이 짧고 가격이 저렴하며,
휴대와 보관이 간편하다는 장점 때문에
대중적인 음식으로 자리 잡았습니다.

[이 예시는 형식 참고용이며, 내용은 주제에 맞게 새로 작성하세요]

주제: ${topic}
`.trim();
  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${apiKey}`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }]
      })
    }
  );

  const data = await res.json();
  const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;

  if (!text) {
    alert("AI 응답 실패");
    return;
  }

  makePPT(parseToSlides(text));
}

function parseToSlides(text) {
  const blocks = text.split("\n\n").map(v => v.trim()).filter(Boolean);

  return blocks.map(block => {
    const lines = block.split("\n").map(v => v.trim()).filter(Boolean);
    return {
      title: String(lines[0] || ""),
      body: String(lines.slice(1).join("\n") || "")
    };
  }).filter(v => v.title && v.body);
}

function makePPT(slidesData) {
  let pptx = new PptxGenJS();

  slidesData.forEach((item, index) => {
    let slide = pptx.addSlide();

    slide.addText(item.title, {
      x: 0.5,
      y: 0.6,
      w: 9,
      h: 1,
      fontSize: 30,
      bold: true
    });

    slide.addText(item.body, {
      x: 0.8,
      y: 2,
      w: 8.5,
      h: 2,
      fontSize: 18
    });

    slide.addText(`${index + 1} / ${slidesData.length}`, {
      x: 8,
      y: 5,
      fontSize: 10,
      color: "888888"
    });
  });

  pptx.writeFile("무제.pptx");
}
</script>

</body>
</html>
