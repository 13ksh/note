<!DOCTYPE html>
<html>
<head>
    <title>fullAutoPPT</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #input-area { margin-bottom: 20px; }
        #prompt-input { width: 80%; padding: 10px; margin-right: 10px; }
        #output-area { 
            border: 1px solid #ccc; 
            padding: 15px; 
            min-height: 100px; 
            white-space: pre-wrap;
            background-color: #f9f9f9;
        }
        #loading { color: blue; display: none; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>fullAutoPPT</h1>

    <div id="input-area">
        <label for="apikey">API 키:</label>
        <input id="apikey"/><br/>
        <a href="https://aistudio.google.com/api-keys" target="_blank">API 키 발급 받기</a><br/><br/>
        <label for="slideCount">슬라이드 수 (8~48):</label>
        <input id="slideCount" type="number" min="8" max="48" value="8" /><br/><br/>
        <label for="prompt-input">프롬프트 입력:</label>
        <input id="prompt-input" rows="4" placeholder="나무가 무엇인가요?" autofocus></input>
        <button onclick="callGeminiApi()">응답 받기</button>
    </div>

    <div id="loading">... 응답을 처리 중입니다 ...</div>
    
    <h2>카드 내용 줄거리:</h2>
    <div id="output-area">여기에 카드 내용 줄거리가 표시됩니다.</div>
    
    <button onclick="callGeminiApi()">다음(완성본 받기)</button>

    <script>
        const input = document.createElement("output-area");
        let API_KEY;
        const MODEL_NAME = "gemini-2.5-flash";
        let API_URL;
        
        const outputElement = document.getElementById('output-area');
        const slideCountElement = document.getElementById('slideCount');
        const promptInputElement = document.getElementById('prompt-input');
        const loadingElement = document.getElementById('loading');
        const basePrompt1 =
`주제가 주어지면  
해당 주제에 대해 “모든 것”을 설명하는  
교육용 PPT를 만들어 주세요.

주제가 주어지면  
학교 발표용으로 사용할 수 있는  
자연스러운 PPT를 만들어 주세요.

조건:
- 교과서나 학습 자료처럼 보이게 작성
- 과도한 전문 용어 사용 금지
- 광고처럼 보이는 표현 금지
- "AI", "자동 생성" 같은 단어 사용 금지
- 초등학생도 이해할 수 있는 쉬운 표현 사용
- 질문형 제목과 설명형 제목을 섞어서 구성
- 전체 흐름이 자연스럽게 이어지도록 구성
- 총 `;
const basePrompt2 = `개의 항목으로 구성 (중요)

스타일 예시: 
라면에 대하여
라면은 전 세계에서 널리 소비되는 즉석식품이다.
간단하게 조리할 수 있어 많은 사람들에게 사랑받고 있다.

라면이란 무엇인가?
라면은 밀가루로 만든 면을 기름에 튀기거나 건조한 식품이다.
뜨거운 물에 끓이기만 하면 바로 먹을 수 있다.

라면의 역사
라면은 1958년 일본에서 처음 만들어졌다.
이후 한국을 포함한 여러 나라로 퍼지며 발전했다.

위 형식과 같은 스타일로만 출력해 주세요.

주제 : `;

        function getCardValue(id) {
            const el = document.getElementById("card"+id);
            return el ? el.value : null;
        }

        async function callGeminiApi() {
            API_KEY = document.getElementById('apikey').value;
            API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;
            const userPrompt = basePrompt1 + slideCountElement.value + basePrompt2 + promptInputElement.value.trim();

            if (userPrompt === "") {
                outputElement.innerText = "프롬프트를 입력해 주세요.";
                return;
            }

            // UI 상태 업데이트
            outputElement.innerText = "";
            loadingElement.style.display = 'block';

            const payload = {
                contents: [
                    {
                        parts: [
                            { text: userPrompt }
                        ]
                    }
                ]
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API 호출 실패: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                // 모델의 응답 텍스트 추출 (안전한 추출 로직)
                let aiResponseText = "응답을 받을 수 없습니다. 데이터 구조를 확인하세요.";
                if (data.candidates && data.candidates.length > 0 && 
                    data.candidates[0].content && data.candidates[0].content.parts && 
                    data.candidates[0].content.parts.length > 0) {
                    aiResponseText = data.candidates[0].content.parts[0].text;
                }
                
                const list67 = aiResponseText
                .split("\n")
                .map(s => s.replace(/^\d{2}\.\s*/, "").trim())
                .map((v, i) => `${v}`);
                outputElement.innerHTML = "";

                for (let i = 1; i <= list67.length; i++) {
                    const input = document.createElement("input");
                    input.type = "text";
                    input.id = "card" + i;
                    input.value = list67[i - 1];
                    input.style.display = "block";
                    input.style.width = "100%";
                    input.style.marginBottom = "6px";

                    outputElement.appendChild(input);
                }
            } catch (error) {
                console.error("오류 발생:", error);
                outputElement.innerText = `오류 발생: ${error.message}. API 키와 네트워크 연결을 확인해 주세요.`;
            } finally {
                // UI 상태 초기화
                loadingElement.style.display = 'none';
            }
        }
    </script>
</body>
</html>