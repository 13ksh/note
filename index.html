<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare Workers í”„ë¡ì‹œ ì´ë¯¸ì§€ ìƒì„±ê¸° (ai.keddie213.workers.dev ì ìš©)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 30px; background-color: #f4f7f6; }
        .container { max-width: 800px; margin: 0 auto; background-color: #ffffff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1 { color: #1e88e5; text-align: center; margin-bottom: 25px; }
        .input-group { margin-bottom: 15px; display: flex; align-items: center; }
        .input-group label { margin-right: 10px; font-weight: bold; width: 100px; flex-shrink: 0; }
        #api-key-input, #prompt-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
        #prompt-container { display: flex; align-items: center; }
        button { padding: 10px 15px; background-color: #1e88e5; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; transition: background-color 0.3s; margin-left: 10px; }
        button:hover { background-color: #1565c0; }
        #status-message { margin-top: 20px; font-size: 16px; color: #e53935; text-align: center; padding: 10px; border: 1px dashed #e53935; border-radius: 6px; }
        #image-container { margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .generated-image { max-width: 100%; height: auto; border: 5px solid #e0e0e0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Workersë¥¼ ì´ìš©í•œ ì´ë¯¸ì§€ ìƒì„±ê¸°</h1>
        <p>API í‚¤ì™€ PromptëŠ” Cloudflare Workers (<code style="background-color: #eee; padding: 2px 4px; border-radius: 4px;">ai.keddie213.workers.dev</code>)ë¥¼ í†µí•´ ì „ì†¡ë©ë‹ˆë‹¤.</p>

        <div class="input-group">
            <label for="api-key-input">API Key:</label>
            <input type="password" id="api-key-input" placeholder="Google AI í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" size="60">
        </div>

        <div id="prompt-container" class="input-group">
            <label for="prompt-input">ì„¤ëª… (Prompt):</label>
            <input type="text" id="prompt-input" placeholder="ìƒì„±í•  ì´ë¯¸ì§€ ì„¤ëª…ì„ ìì„¸í•˜ê²Œ ì…ë ¥í•˜ì„¸ìš”" required>
            <button onclick="generateImage()">ìƒì„± ì‹œì‘</button>
        </div>
        
        <p id="status-message">í‚¤ì™€ ì„¤ëª…ì„ ì…ë ¥í•˜ê³  'ìƒì„± ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
        
        <div id="image-container">
            </div>
    </div>

    <script>
        // ì‚¬ìš©ì Worker ì£¼ì†Œ: ai.keddie213.workers.dev ì ìš©
        const WORKERS_ENDPOINT_URL = "https://ai.keddie213.workers.dev"; 

        async function generateImage() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            const prompt = document.getElementById('prompt-input').value.trim();
            const statusMessage = document.getElementById('status-message');
            const imageContainer = document.getElementById('image-container');
            
            if (!apiKey || !prompt) {
                statusMessage.textContent = 'ğŸš¨ ì˜¤ë¥˜: API í‚¤ì™€ ì„¤ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!';
                statusMessage.style.color = '#e53935';
                statusMessage.style.borderColor = '#e53935';
                return;
            }

            // UI ì—…ë°ì´íŠ¸
            imageContainer.innerHTML = '';
            statusMessage.textContent = 'â³ Workerë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';
            statusMessage.style.color = '#ff9800';
            statusMessage.style.borderColor = '#ff9800';

            try {
                // Workers ì—”ë“œí¬ì¸íŠ¸ë¡œ API Keyì™€ Promptë¥¼ í•¨ê»˜ ì „ì†¡
                const response = await fetch(WORKERS_ENDPOINT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ apiKey, prompt }),
                });

                const data = await response.json();
                
                if (response.ok && data.generatedImages && data.generatedImages.length > 0) {
                    // ì„±ê³µì ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë°›ì€ ê²½ìš°
                    statusMessage.textContent = 'âœ… ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ!';
                    statusMessage.style.color = '#4caf50';
                    statusMessage.style.borderColor = '#4caf50';
                    
                    data.generatedImages.forEach(img => {
                        const base64ImageBytes = img.image.imageBytes;
                        const imgElement = document.createElement('img');
                        imgElement.src = `data:image/png;base64,${base64ImageBytes}`;
                        imgElement.classList.add('generated-image');
                        imgElement.alt = prompt;
                        imageContainer.appendChild(imgElement);
                    });
                } else if (data.error) {
                    // Google APIì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ Workerê°€ ì „ë‹¬í•œ ê²½ìš°
                    statusMessage.textContent = `âŒ API ì˜¤ë¥˜ (Worker ê²½ìœ ): ${data.error.message}`;
                    statusMessage.style.color = '#e53935';
                    statusMessage.style.borderColor = '#e53935';
                    console.error('API Error via Worker:', data.error);
                } else {
                     // ê¸°íƒ€ ì‘ë‹µ ë¬¸ì œ
                     statusMessage.textContent = `âŒ ìƒì„± ì˜¤ë¥˜. HTTP ìƒíƒœ ì½”ë“œ: ${response.status} (Worker ì‘ë‹µ í™•ì¸ í•„ìš”)`;
                     statusMessage.style.color = '#e53935';
                     statusMessage.style.borderColor = '#e53935';
                }

            } catch (error) {
                // Workers ì—°ê²° ìì²´ì˜ ë¬¸ì œ (ì´ ê²½ìš°ì—ë„ Failed to fetch ë°œìƒ ê°€ëŠ¥)
                statusMessage.textContent = `âŒ Workers ì—°ê²° ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
                statusMessage.style.color = '#e53935';
                statusMessage.style.borderColor = '#e53935';
                console.error('Workers Fetch Error:', error);
            }
        }
    </script>
</body>
</html>